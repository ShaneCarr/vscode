{
  "version": "2.0.0",

  // --------------------------------------------------------------------------------------
  // Inputs
  // --------------------------------------------------------------------------------------
  "inputs": [
    {
      "id": "lab",
      "type": "promptString",
      "description": "Lab name (e.g. tl42, dogfood-17)",
      "default": "$LAB"
    },
    {
      "id": "service",
      "type": "pickString",
      "description": "Service to operate on",
      "options": [
        "grouper",
        "grouper-service",
        "reporter",
        "grouper-client",
        "grouper2-client",
        "grouper2-api"
      ],
      "default": "grouper"
    },
    {
      "id": "module",
      "type": "pickString",
      "description": "Maven module (artifactId) for -pl",
      "options": ["grouper", "grouper-service", "reporter", "grouper-client", "grouper2-client", "grouper2-api"],
      "default": "grouper2-api"
    },
    {
      "id": "testName",
      "type": "promptString",
      "description": "Surefire test selector (e.g. FooTest or FooTest#testBar)",
      "default": "*Test"
    },
    {
      "id": "java",
      "type": "pickString",
      "description": "Java version (sdk use java ...)",
      "options": ["17.0.10-tem", "21.0.2-tem"],
      "default": "17.0.10-tem"
    },
    {
      "id": "url",
      "type": "promptString",
      "description": "URL to curl",
      "default": "https://www.yammer.com/api/v1/networks/current"
    },
    {
      "id": "centralPath",
      "type": "promptString",
      "description": "central <service/path>",
      "default": "workfeed-web/api/v1/networks/current"
    },
    {
      "id": "icmQuery",
      "type": "promptString",
      "description": "ICM query / criteria",
      "default": "OwningServiceId eq 20732"
    },
    {
      "id": "icmCount",
      "type": "promptString",
      "description": "How many incidents",
      "default": "5"
    }
  ],

  // --------------------------------------------------------------------------------------
  // Tasks
  // --------------------------------------------------------------------------------------
  "tasks": [
    // ======================================================================================
    // Sanity / Debug
    // ======================================================================================
    {
      "label": "SANITY: echo hello",
      "type": "shell",
      "command": "echo hello",
      "problemMatcher": []
    },

    // ======================================================================================
    // Lab (Yamdev)
    // ======================================================================================
    {
      "label": "Lab: Deploy (tldeploylocal) [pick lab + service]",
      "type": "shell",
      "command": "zsh",
      "args": ["-lic", "tldeploylocal ${input:lab} ${input:service}"],
      "problemMatcher": [],
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": true }
    },
    {
      "label": "Lab: Debug Proxy (tldebugproxy) [pick lab + service]",
      "type": "shell",
      "command": "zsh",
      "args": ["-lic", "tldebugproxy ${input:lab} ${input:service}"],
      "problemMatcher": [],
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": true }
    },
    {
      "label": "Lab: Logs (tlapplogs) [pick lab + service]",
      "type": "shell",
      "command": "zsh",
      "args": ["-lic", "tlapplogs ${input:lab} ${input:service}"],
      "problemMatcher": [],
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": true }
    },
    {
      "label": "Lab: Request Logs (tlrequestlogs) [pick lab + service]",
      "type": "shell",
      "command": "zsh",
      "args": ["-lic", "tlrequestlogs ${input:lab} ${input:service}"],
      "problemMatcher": [],
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": true }
    },
    {
      "label": "Lab: Pod Status (tlps) [pick lab]",
      "type": "shell",
      "command": "zsh",
      "args": ["-lic", "tlps ${input:lab}"],
      "problemMatcher": [],
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": true }
    },
    {
      "label": "Lab: Deploy Logs (tldeploylogs) [pick lab + service]",
      "type": "shell",
      "command": "zsh",
      "args": ["-lic", "tldeploylogs ${input:lab} ${input:service}"],
      "problemMatcher": [],
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": true }
    },
    {
      "label": "Lab: Shell (tlshell) [pick lab + service]",
      "type": "shell",
      "command": "zsh",
      "args": ["-lic", "tlshell ${input:lab} ${input:service}"],
      "problemMatcher": [],
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": false }
    },
    {
      "label": "Lab: Config (tlconfig) [pick lab + service]",
      "type": "shell",
      "command": "zsh",
      "args": ["-lic", "tlconfig ${input:lab} ${input:service}"],
      "problemMatcher": [],
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": true }
    },
    {
      "label": "Lab: Kill Proxies (tlnoproxy)",
      "type": "shell",
      "command": "zsh",
      "args": ["-lic", "tlnoproxy"],
      "problemMatcher": [],
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": true }
    },

    // ======================================================================================
    // Maven: Fast paths (high ROI for “I keep seeing stale / mismatched builds”)
    //
    // Notes:
    // - The "-am" (also-make) tasks rebuild dependent modules in the same reactor build.
    //   This is the #1 antidote to “works, then suddenly generated code can't find symbols”.
    // - The "paranoid" clean wipes *all* module targets from repo root.
    // ======================================================================================

    {
      "label": "Maven: clean",
      "type": "shell",
      "command": "zsh",
      "args": ["-lic", "mvn clean"],
      "problemMatcher": ["$maven"],
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": true }
    },
    {
      "label": "Maven: clean (paranoid) [delete all module targets]",
      "type": "shell",
      "command": "zsh",
      "args": ["-lic", "find . -name target -type d -prune -print -exec rm -rf {} +"],
      "problemMatcher": [],
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": true }
    },

    {
      "label": "Maven: package (fast) [skip tests + skip ITs + skip coverage/quality]",
      "type": "shell",
      "command": "zsh",
      "args": [
        "-lic",
        "mvn package -DskipTests -DskipITs -Djacoco.skip=true -Dcheckstyle.skip=true -Dspotbugs.skip=true"
      ],
      "problemMatcher": ["$maven"],
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": true }
    },
    {
      "label": "Maven: clean + package (fast) [skip tests + skip ITs + skip coverage/quality]",
      "type": "shell",
      "command": "zsh",
      "args": [
        "-lic",
        "mvn clean package -DskipTests -DskipITs -Djacoco.skip=true -Dcheckstyle.skip=true -Dspotbugs.skip=true"
      ],
      "problemMatcher": ["$maven"],
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": true }
    },

    // --- Reactor-safe module builds: rebuild module + deps consistently -------------------

    {
      "label": "Maven: module clean + package (-am) [prompt module, fixes stale deps]",
      "type": "shell",
      "command": "zsh",
      "args": [
        "-lic",
        "mvn -pl :${input:module} -am clean package -DskipTests -DskipITs -Djacoco.skip=true -Dcheckstyle.skip=true -Dspotbugs.skip=true"
      ],
      "problemMatcher": ["$maven"],
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": true }
    },

    // FIXED: label claimed "selector optional" but task didn't use it.
    {
      "label": "Maven: module test (fast) (-am) [prompt module + surefire selector]",
      "type": "shell",
      "command": "zsh",
      "args": [
        "-lic",
        "mvn -pl :${input:module} -am -DskipITs -Dtest='${input:testName}' test"
      ],
      "problemMatcher": ["$maven"],
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": true }
    },

    // ======================================================================================
    // Maven: Tests
    // ======================================================================================
    {
      "label": "Maven: test (fast) [skip ITs]",
      "type": "shell",
      "command": "zsh",
      "args": ["-lic", "mvn -DskipITs test"],
      "problemMatcher": ["$maven"],
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": true }
    },

    // NEW: same as above but forces snapshot updates (no ~/.m2 nuking).
    {
      "label": "Maven: test (fast, -U) [force snapshot updates + skip ITs]",
      "type": "shell",
      "command": "zsh",
      "args": ["-lic", "mvn -U -DskipITs test"],
      "problemMatcher": ["$maven"],
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": true }
    },

    {
      "label": "Maven: test (single) [prompt]",
      "type": "shell",
      "command": "zsh",
      "args": ["-lic", "mvn -Dtest='${input:testName}' test"],
      "problemMatcher": ["$maven"],
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": true }
    },

    // SDKMAN + Maven (optional)
    {
      "label": "Maven: test (fast) [pick java via sdkman]",
      "type": "shell",
      "command": "zsh",
      "args": ["-lic", "sdk use java ${input:java} >/dev/null && mvn -DskipITs test"],
      "problemMatcher": ["$maven"],
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": true }
    },

    // ======================================================================================
    // Maven: Coverage
    //
    // Repo-dependent:
    // - "jacoco:report" works if JaCoCo is configured as a plugin (common).
    // - "-Pcoverage" is [NEEDS CONFIRMATION] (only if your repo defines that profile).
    // ======================================================================================

    {
      "label": "Maven: coverage (JaCoCo) [clean verify + report]",
      "type": "shell",
      "command": "zsh",
      "args": ["-lic", "mvn clean verify jacoco:report"],
      "problemMatcher": ["$maven"],
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": true }
    },
    {
      "label": "Maven: coverage (unit tests only) [skip ITs + report]",
      "type": "shell",
      "command": "zsh",
      "args": ["-lic", "mvn clean test -DskipITs jacoco:report"],
      "problemMatcher": ["$maven"],
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": true }
    },
    {
      "label": "Maven: coverage (profile=coverage) [NEEDS CONFIRMATION]",
      "type": "shell",
      "command": "zsh",
      "args": ["-lic", "mvn clean verify -Pcoverage"],
      "problemMatcher": ["$maven"],
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": true }
    },

    // ======================================================================================
    // Maven: “Why is Maven being weird?” tools
    // ======================================================================================
    {
      "label": "Maven: dependency tree (verbose)",
      "type": "shell",
      "command": "zsh",
      "args": ["-lic", "mvn -Dverbose dependency:tree"],
      "problemMatcher": ["$maven"],
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": true }
    },
    {
      "label": "Maven: effective POM",
      "type": "shell",
      "command": "zsh",
      "args": ["-lic", "mvn help:effective-pom"],
      "problemMatcher": ["$maven"],
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": true }
    },
    {
      "label": "Maven: show active profiles",
      "type": "shell",
      "command": "zsh",
      "args": ["-lic", "mvn help:active-profiles"],
      "problemMatcher": ["$maven"],
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": true }
    },

    // ======================================================================================
    // Yamcurl
    // ======================================================================================
    {
      "label": "YamCurl: Copy AAD token",
      "type": "shell",
      "command": "zsh",
      "args": ["-lic", "yamcurl copy"],
      "problemMatcher": [],
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": true }
    },
    {
      "label": "YamCurl: curl URL [prompt]",
      "type": "shell",
      "command": "zsh",
      "args": ["-lic", "yamcurl curl '${input:url}'"],
      "problemMatcher": [],
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": true }
    },
    {
      "label": "YamCurl: central service path [prompt]",
      "type": "shell",
      "command": "zsh",
      "args": ["-lic", "yamcurl central '${input:centralPath}'"],
      "problemMatcher": [],
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": true }
    },

    // ======================================================================================
    // ICM
    // ======================================================================================
    {
      "label": "ICM: Report [prompt]",
      "type": "shell",
      "command": "zsh",
      "args": ["-lic", "icmreport '${input:icmQuery}' ${input:icmCount}"],
      "problemMatcher": [],
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": true }
    }
  ]
}
